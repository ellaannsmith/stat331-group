---
title: "Project Proposal"
author: 'Alexis Hegarty, Ella Smith, Ashlyn Philips, and Amy Truong'
format: 
  html:
    self-contained: true
    code-tools: true
    toc: true
editor: source
execute: 
  error: true
  echo: true
  message: false
  warning: false
---

```{r}
#| code-fold: true
library(tidyverse)
library(broom)

co2 <- read_csv("co2.csv", col_names = TRUE)
cdmt <- read_csv("cdmt.csv", col_names = TRUE)
```
Hey all, I'm here. It's amy!

hiiii its ash!

### Data Description:

The data we are using in our analysis is sourced from [Gapminder](https://www.gapminder.org/data/documentation/). The Gapminder data sets are compiled of world data ranging from 1800 to 2020. The variables, documented by country (using current geographic boundaries), are indicators of global development and evolution through the past two centuries. Examples of these variables include, child mortality, GDP, fertility rates, life expectancy rates, and more.

The data sets that we will be using in our analysis include two quantitative variables: Carbon Dioxide (CO2) and Child Mortality.

The Child Mortality Rate data set combines data from multiple sources to create a data set of child deaths under the age of 5 for each country from 1800 to 2100. Child mortality is measured as the number of 0-5 years dying per 1000 children born. The data set has three variables: country, year, and child mortality rate.

The Carbon Dioxide data set combines data from multiple sources to create a data set of CO2 emissions in tonnes per capita for each country from 1800 to 2022. The data set has three variables: country, year, and CO2 emissions per capita. Both data sets we are using contain from 194 countries.

### Hypothesis:

We will use CO2 as our explantory variable and Child mortality as our response varaible.

We think that there maybe a relationship between these two variables. We understand that in general CO2 emissions are harmful to humans. From 1800 to 2022 as the world became more industrialized and CO2 emissions per capita exponentially, this also increased child mortality.

However, we are also aware that industrialization also could have lowered child mortality rates through the increase in medicine and technology.

Our investigation aims to explore this nuanced relationship between CO2 emissions and child mortality. Using historical data and statistical analyses, we aim to provide a more comprehensive understanding of the evolution of the relationship between these two variables within the last two decades.

### Cleaning the Data

A glaring factor within the data is the child mortality dataset contains data all the way to 2100. This means the data past 2018 (noted in data description in Gapminder) is predicted. For the purposes of this analysis and the data we have for CO2 emissions, we will only use data from 1800 to 2018.

In our data cleaning process we will omit observations with at least one variable missing. We are aware that omitting these missing variables decreases the sample size and may lead us to miss important information. Since we are using ggplot and lm--which drop missing observations anyway--it makes sense to remove these variables for the entire analysis.

The two data sets will also need to be merged into one data set in long format using the pivot_longer function.

The following code performs these three tasks:

### Merge & Clean Data:

```{r}
#| code-fold: true

co2_cdmt <- cdmt %>%
  mutate(across(-country, as.character)) %>%
  pivot_longer(cols = -country, names_to = 'year', values_to = 'cdmt') %>%
  mutate(year = as.character(year)) %>%
  
  full_join(
    co2 %>%
      mutate(across(-country, as.character)) %>%
      pivot_longer(cols = -country, names_to = 'year', values_to = 'co2') %>%
      mutate(year = as.character(year)),
    by = c("country", "year")
  ) %>%
  
  filter(year < 2018) %>%
  na.omit()


```

### Data Visualization


```{r}
#| code-fold: true

co2_cdmt %>%
  mutate(year = as.numeric(year),
         co2 = as.numeric(co2),
         cdmt = as.numeric(cdmt)) %>%
  group_by(year) %>%
  summarize(avg_co2 = mean(co2),
            avg_cdmt = mean(cdmt)) %>%
  
  ggplot(aes(x = year)) +
  geom_line(aes(y = avg_co2, color = "co2"), size = 1.5) +
  geom_line(aes(y = avg_cdmt, color = "cdmt"), size = 1.5) +labs(title = "Relationship CO2 Emmissions and Child Mortality Rates",
       x = "Year",
       y = "", subtitle = "Emissions in tonnes per capita/proportion of deaths per 1000 births") +
  
  theme_minimal()
```


Logged Relationship between CO2 emissions and child mortality rates over time graph:


```{r}
#| code-fold: true

co2_cdmt %>%
  mutate(year = as.numeric(year),
         co2 = as.numeric(co2),
         cdmt = as.numeric(cdmt)) %>%
  group_by(year) %>%
  summarize(avg_co2 = mean(co2),
            avg_cdmt = mean(cdmt)) %>%
  
  ggplot(aes(x = year)) +
  geom_line(aes(y = log(avg_co2), color = "log co2"), size = 1.5) +
  geom_line(aes(y = log(avg_cdmt), color = "log cdmt"), size = 1.5) +labs(title = "Relationship CO2 Emmissions and Child Mortality Rates",
       x = "Year",
       y = "", subtitle = "Emissions in tonnes per capita/proportion of deaths per 1000 births") +
  
  theme_minimal()
```

From this graph we can observe the log transformed data of average carbon dioxide emissions and average child mortality rates from 1800 to 2018 across 192 countries. We logged the data so that we could visually compare the two variables on the same scale. From 1800 to about 1900 is consistently around an average of 6. Just after 1900 the line started to steadily decrease until it almost reached 3 by 2018. The trend for carbon dioxide is slightly different. While there seems to be no change between 1800 and 1825–the emissions are consistently at -3, shortly after that period, the CO2 emissions begin to rapidly increase. There are a few dips in the increasing trend line between 1915 and 1950, but the trend continues to increase. It’s also important to note that there are a few missing variables from the early 2000s. But by 2018 the CO2 emissions have increased to 3.

Average CO2 vs. Average CDMT:

```{r}
#| code-fold: true
graph<-
co2_cdmt %>%
  mutate(year = as.numeric(year),
         co2 = as.numeric(co2), 
         cdmt = as.numeric(cdmt)) %>%  
  group_by(year) %>%  
  summarize(avg_co2 = mean(co2),
            avg_cdmt = mean(cdmt)) 
graph |>
  ggplot(aes(x = avg_co2, y = avg_cdmt)) +  
  geom_jitter(alpha = 0.7, color = "steelblue", size = 3) +    
  labs(title = "Average CO2 vs. CDMT", 
       subtitle = "Average CDMT", 
       x = "Average CO2",
       y = "") + 
  theme_minimal() +  
  theme(plot.title = element_text(size = 20, face = "bold"),      
        plot.subtitle = element_text(size = 12), 
        axis.text = element_text(size = 10))

```

By observing this graph we can infer an important detail about the relationship between average CO2 emissions and average child mortality rate. The average is taken across all 192 countries in our data set for a particular year. The data is not displayed by year in this graph. As for the relationship between the two variables, as CO2 increases child mortality rates decrease.

##### Fitting Linear Regression:

```{r}
#| code-fold: true
reg <- lm(avg_cdmt~avg_co2, data = graph)

graph |>
  ggplot(aes(x=avg_co2, y=avg_cdmt))+
  geom_jitter()+
  geom_smooth(method = "lm")+ 
  labs(title = "Linear Regression for CO2 and Child Mortality", 
       xlab = "Average CO2 Emmisions", 
       ylab = "Average Child Mortality Rate")

```

The statistical method we are using to analyze the data is linear regression. This model is used to examine the relationship between an independent and dependent variable. In this case, CO2 emissions is the independent variable and child mortality rate is the dependent variable. The linear model assumes these two variables have a linear relationship; the changes in the independent variables are associated with a constant change in the dependent variable. This is the form for our model: y = 0 + x1 +\
Where y represents the dependent variable, child mortality and x1 represents in the independent variable, CO2 emissions.

```{r}
#| code-fold: true
broom:: tidy(reg)
summary(reg)
```

Estimated Regression Model in Context:

Average Child Mortality Rate = 5.2047 - 0.0127\*CO2

Coefficient interpretations:

Intercept: The intercept is the value of the dependent variable when the independent variable is 0. When CO2 emissions are at 0, the average predicted value for child mortality is 5.2047.

Slope: The slope represents the change in the dependent variable for a one unit increase in the dependent variable. For every one unit increase in average CO2 emissions the average cdmt decreases by 0.0127.

Description of Fit: We have an adjusted R2 of 0.9379 so we observe a strong negative linear corelation between Child Mortality Rate.

#### Residual Plots

```{r}
#| code-fold: true
residual <- broom::augment(reg)

residual_co2 <- ggplot(data = reg, aes(x = avg_co2, y = .resid)) +
  geom_point() +
  labs(x = "Average CO2", y = NULL, subtitle = "Residuals", title = "Residual Plot of Average CO2")

residual_cdmt <- ggplot(data = reg, aes(x = avg_cdmt, y = .resid)) +
  geom_point() +
  labs (x = "Average Child Mortality", y = NULL, subtitle = "Residuals", title = "Residual Plot of Average Child Mortality")
residual_co2
residual_cdmt
```
